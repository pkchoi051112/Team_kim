// ê³µí†µ ë°ì´í„° ë¡œë”©
function loadRestaurants() {
  return fetch("./data/restaurants.json")
    .then(res => res.json());
}

// â­ ì¡°ê±´ í™•ì¸
function star(name, priceMin) {
  return priceMin <= 7000 ? name + " â­" : name;
}

// í˜ì´ì§€ ë¼ìš°íŒ…
document.addEventListener("DOMContentLoaded", () => {

  const path = window.location.pathname;

  if (path.includes("index.html") || path === "/") {
    loadNearby();
  } else if (path.includes("map.html")) {
    loadMap();
  } else if (path.includes("cheap.html")) {
    loadCheap();
  }

});

// ğŸ“Œ 1í˜ì´ì§€: GPS ê¸°ë°˜
function loadNearby() {
  if(!navigator.geolocation) return;
  
  navigator.geolocation.getCurrentPosition((pos)=>{
    let myLat = pos.coords.latitude;
    let myLng = pos.coords.longitude;
    
    loadRestaurants().then(data=>{
      data.forEach(store=>{
        const item = document.createElement("div");
        item.className = "store";
        item.innerHTML = `
          <div><strong>${star(store.name, store.priceMin)}</strong></div>
          <div>ì¢…ë¥˜: ${store.category}</div>
          <div>ê°€ê²©: ${store.priceMin}ì›~${store.priceMax}ì›</div>
        `;
        document.getElementById("storeList").appendChild(item);
      });
    });
  });
}

// ğŸ“Œ 2í˜ì´ì§€: ì§€ë„
function loadMap() {
  loadRestaurants().then(data=>{
    let container = document.getElementById('map');
    let map = new kakao.maps.Map(container, {
      center: new kakao.maps.LatLng(37.3006, 126.8382),
      level: 3
    });

    data.forEach(store=>{
      let marker = new kakao.maps.Marker({
        map: map,
        position: new kakao.maps.LatLng(store.coords.lat, store.coords.lng)
      });

      const item = document.createElement("div");
      item.className = "store";
      item.innerHTML = `
        <div><strong>${star(store.name, store.priceMin)}</strong></div>
        <div>ì¢…ë¥˜: ${store.category}</div>
        <div>ê°€ê²©: ${store.priceMin}ì›~${store.priceMax}ì›</div>
      `;
      document.getElementById("storeList").appendChild(item);
    });
  });
}

// ğŸ“Œ 3í˜ì´ì§€: ê°€ì„±ë¹„
function loadCheap() {
  loadRestaurants().then(data=>{
    data.filter(store=>store.priceMin <= 7000)
        .forEach(store=>{
          const item = document.createElement("div");
          item.className = "store";
          item.innerHTML = `
            <div><strong>${star(store.name, store.priceMin)}</strong></div>
            <div>ì¢…ë¥˜: ${store.category}</div>
            <div>ê°€ê²©: ${store.priceMin}ì›~${store.priceMax}ì›</div>
          `;
          document.getElementById("storeList").appendChild(item);
        });
  });
}
